/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v1.1.9 - 2017-09-01
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com> (https://github.com/revolunet)
 * @contributors Julien Bouquillon (https://github.com/revolunet),Justin Saunders (https://github.com/justinsa),Chris Esplin (https://github.com/deltaepsilon),Adam Misiorny (https://github.com/adam187)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

!function(t,n){"use strict";"undefined"!=typeof module&&module.exports?(n("undefined"==typeof angular?require("angular"):angular),module.exports="angular-google-analytics"):"function"==typeof define&&define.amd?define(["angular"],n):n(t.angular)}(this,function(t,n){"use strict";return t.module("angular-google-analytics",[]).provider("Analytics",function(){var e,i,r,c,a,o=!0,s=!1,u=!1,l="USD",f=!1,d=!1,p=!1,m=!1,g=!1,h=!1,k=!1,_=!1,y=!1,E=!1,v=!1,b="$routeChangeSuccess",w=!1,T=!1,A=!1,D=!1,P="",x=!0,L=!1;this.log=[],this.offlineQueue=[],this.setAccount=function(i){return e=t.isUndefined(i)||!1===i?n:t.isArray(i)?i:t.isObject(i)?[i]:[{tracker:i,trackEvent:!0}],this},this.trackPages=function(t){return x=!!t,this},this.trackPrefix=function(t){return P=t,this},this.setDomainName=function(t){return r=t,this},this.useDisplayFeatures=function(t){return p=!!t,this},this.useAnalytics=function(t){return o=!!t,this},this.useEnhancedLinkAttribution=function(t){return k=!!t,this},this.useCrossDomainLinker=function(t){return u=!!t,this},this.setCrossLinkDomains=function(t){return i=t,this},this.setPageEvent=function(t){return b=t,this},this.useECommerce=function(t,n){return g=!!t,h=!!n,this},this.setCurrency=function(t){return l=t,this},this.setRemoveRegExp=function(t){return t instanceof RegExp&&(a=t),this},this.setExperimentId=function(t){return c=t,this},this.ignoreFirstPageLoad=function(t){return _=!!t,this},this.trackUrlParams=function(t){return L=!!t,this},this.disableAnalytics=function(t){return m=!!t,this},this.setHybridMobileSupport=function(t){return E=!!t,this},this.startOffline=function(t){return!0===(v=!!t)&&this.delayScriptTag(!0),this},this.delayScriptTag=function(t){return d=!!t,this},this.logAllCalls=function(t){return y=!!t,this},this.enterTestMode=function(){return A=!0,this},this.enterDebugMode=function(t){return f=!0,D=!!t,this},this.readFromRoute=function(t){return w=!!t,this},this.readFromUIRouter=function(t){return T=!!t,this},this.$get=["$document","$location","$log","$rootScope","$window","$injector",function(j,C,I,S,$,q){var F=this,N=function(n,e){return t.isObject(e)&&t.isDefined(e[n])},U=function(t,n,e){return N(t,n)&&n[t]===e},M=function(n,e){return t.isString(e)?e+"."+n:N("name",e)?e.name+"."+n:n},O={};w?q.has("$route")?O=q.get("$route"):I.warn("$route service is not available. Make sure you have included ng-route in your application dependencies."):T&&(q.has("$state")?O=q.get("$state"):I.warn("$state service is not available. Make sure you have included ng-route in your application dependencies."));var R=function(){if((w||T)&&O.current&&"pageTrack"in O.current)return O.current.pageTrack;var t=L?C.url():C.path();return a?t.replace(a,""):t},Q=function(){var n={utm_source:"campaignSource",utm_medium:"campaignMedium",utm_term:"campaignTerm",utm_content:"campaignContent",utm_campaign:"campaignName"},e={};return t.forEach(C.search(),function(i,r){var c=n[r];t.isDefined(c)&&(e[c]=i)}),e},B=function(t,n,e,i,r,c,a,o,s){var u={};return t&&(u.id=t),n&&(u.affiliation=n),e&&(u.revenue=e),i&&(u.tax=i),r&&(u.shipping=r),c&&(u.coupon=c),a&&(u.list=a),o&&(u.step=o),s&&(u.option=s),u},V=function(t){return P+(t||R())},X=function(n,e){var i="",r="https:"===document.location.protocol,c="chrome-extension:"===document.location.protocol,a=!0===o&&!0===E;return n=t.isString(n)?n:"",e=t.isString(e)?e:"",""!==n&&(i="http:"+n),(c||a||r&&""!==e)&&(i="https:"+e),i},G=function(t){!o&&$._gaq&&"function"==typeof t&&t()},H=function(){var t=Array.prototype.slice.call(arguments);!0!==v?($._gaq||($._gaq=[]),!0===y&&F._log.apply(F,t),$._gaq.push(t)):F.offlineQueue.push([H,t])},z=function(t){o&&$.ga&&"function"==typeof t&&t()},J=function(){var t=Array.prototype.slice.call(arguments);!0!==v?"function"==typeof $.ga?(!0===y&&F._log.apply(F,t),$.ga.apply(null,t)):F._log("warn","ga function not set on window"):F.offlineQueue.push([J,t])},K=function(t){var n=Array.prototype.slice.call(arguments,1),i=n[0],r=[];"function"==typeof t?e.forEach(function(n){t(n)&&r.push(n)}):r=e,0!==r.length?r.forEach(function(t){N("select",t)&&"function"==typeof t.select&&!t.select(n)||(n[0]=M(i,t),J.apply(F,n))}):J.apply(F,n)};return this._log=function(){var t=Array.prototype.slice.call(arguments);if(t.length>0){if(t.length>1)switch(t[0]){case"debug":case"error":case"info":case"log":case"warn":I[t[0]](t.slice(1))}F.log.push(t)}},this._registerScriptTags=function(){var t,n=j[0],i=X();if(!0===s)return F._log("warn","Script tags already created"),!1;if(!0===m&&e.forEach(function(t){F._log("info","Analytics disabled: "+t.tracker),$["ga-disable-"+t.tracker]=!0}),!0===o){if(t=i+"//www.google-analytics.com/"+(f?"analytics_debug.js":"analytics.js"),!0!==A?function(t,n,e,i,r,c,a){t.GoogleAnalyticsObject=r,t[r]=t[r]||function(){(t[r].q=t[r].q||[]).push(arguments)},t[r].l=1*new Date,c=n.createElement(e),a=n.getElementsByTagName(e)[0],c.async=1,c.src=i,a.parentNode.insertBefore(c,a)}(window,n,"script",t,"ga"):("function"!=typeof $.ga&&($.ga=function(){}),F._log("inject",t)),D&&($.ga_debug={trace:!0}),c){var r=n.createElement("script"),a=n.getElementsByTagName("script")[0];r.src=i+"//www.google-analytics.com/cx/api.js?experiment="+c,a.parentNode.insertBefore(r,a)}}else t=X("//www","//ssl")+".google-analytics.com/ga.js",!0===p&&(t=i+"//stats.g.doubleclick.net/dc.js"),!0!==A?function(){var e=n.createElement("script");e.type="text/javascript",e.async=!0,e.src=t;var i=n.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}():F._log("inject",t);return s=!0,!0},this._registerTrackers=function(){return!e||e.length<1?(F._log("warn","No accounts to register"),!1):(!0===o?e.forEach(function(n){n.crossDomainLinker=N("crossDomainLinker",n)?n.crossDomainLinker:u,n.crossLinkDomains=N("crossLinkDomains",n)?n.crossLinkDomains:i,n.displayFeatures=N("displayFeatures",n)?n.displayFeatures:p,n.enhancedLinkAttribution=N("enhancedLinkAttribution",n)?n.enhancedLinkAttribution:k,n.set=N("set",n)?n.set:{},n.trackEcommerce=N("trackEcommerce",n)?n.trackEcommerce:g,n.trackEvent=!!N("trackEvent",n)&&n.trackEvent;var e={};N("fields",n)&&(e=n.fields),!0===n.crossDomainLinker&&(e.allowLinker=!0),N("name",n)&&(e.name=n.name),n.fields=e,J("create",n.tracker,n.fields),!0===E&&J(M("set",n),"checkProtocolTask",null);for(var r in n.set)n.set.hasOwnProperty(r)&&J(M("set",n),r,n.set[r]);!0===n.crossDomainLinker&&(J(M("require",n),"linker"),t.isDefined(n.crossLinkDomains)&&J(M("linker:autoLink",n),n.crossLinkDomains)),n.displayFeatures&&J(M("require",n),"displayfeatures"),n.trackEcommerce&&(h?(J(M("require",n),"ec"),J(M("set",n),"&cu",l)):J(M("require",n),"ecommerce")),n.enhancedLinkAttribution&&J(M("require",n),"linkid"),x&&!_&&J(M("send",n),"pageview",V())}):(e.length>1&&(F._log("warn","Multiple trackers are not supported with ga.js. Using first tracker only"),e=e.slice(0,1)),H("_setAccount",e[0].tracker),r&&H("_setDomainName",r),k&&H("_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"),x&&!_&&(a?H("_trackPageview",R()):H("_trackPageview"))),!0)},this._ecommerceEnabled=function(t,n){var e=g&&!h;return!0===t&&!1===e&&(g&&h?F._log("warn",n+" is not available when Enhanced Ecommerce is enabled with analytics.js"):F._log("warn","Ecommerce must be enabled to use "+n+" with analytics.js")),e},this._enhancedEcommerceEnabled=function(t,n){var e=g&&h;return!0===t&&!1===e&&F._log("warn","Enhanced Ecommerce must be enabled to use "+n+" with analytics.js"),e},this._trackPage=function(e,i,r){i=i||j[0].title,G(function(){H("_set","title",i),H("_trackPageview",V(e))}),z(function(){var c={page:V(e),title:i};t.extend(c,Q()),t.isObject(r)&&t.extend(c,r),K(n,"send","pageview",c)})},this._trackEvent=function(n,e,i,r,c,a){G(function(){H("_trackEvent",n,e,i,r,!!c)}),z(function(){var o={};t.isDefined(c)&&(o.nonInteraction=!!c),t.isObject(a)&&t.extend(o,a),t.isDefined(o.page)||(o.page=V()),K(function(t){return U("trackEvent",t,!0)},"send","event",n,e,i,r,o)})},this._addTrans=function(t,n,e,i,r,c,a,o,s){G(function(){H("_addTrans",t,n,e,i,r,c,a,o)}),z(function(){if(F._ecommerceEnabled(!0,"addTrans")){K(function(t){return U("trackEcommerce",t,!0)},"ecommerce:addTransaction",{id:t,affiliation:n,revenue:e,tax:i,shipping:r,currency:s||"USD"})}})},this._addItem=function(t,n,e,i,r,c){G(function(){H("_addItem",t,n,e,i,r,c)}),z(function(){if(F._ecommerceEnabled(!0,"addItem")){K(function(t){return U("trackEcommerce",t,!0)},"ecommerce:addItem",{id:t,name:e,sku:n,category:i,price:r,quantity:c})}})},this._trackTrans=function(){G(function(){H("_trackTrans")}),z(function(){if(F._ecommerceEnabled(!0,"trackTrans")){K(function(t){return U("trackEcommerce",t,!0)},"ecommerce:send")}})},this._clearTrans=function(){z(function(){if(F._ecommerceEnabled(!0,"clearTrans")){K(function(t){return U("trackEcommerce",t,!0)},"ecommerce:clear")}})},this._addProduct=function(n,e,i,r,c,a,o,s,u,l){G(function(){H("_addProduct",n,e,i,r,c,a,o,s,u)}),z(function(){if(F._enhancedEcommerceEnabled(!0,"addProduct")){var f={id:n,name:e,category:i,brand:r,variant:c,price:a,quantity:o,coupon:s,position:u};t.isObject(l)&&t.extend(f,l),K(function(t){return U("trackEcommerce",t,!0)},"ec:addProduct",f)}})},this._addImpression=function(t,n,e,i,r,c,a,o){G(function(){H("_addImpression",t,n,e,i,r,c,a,o)}),z(function(){if(F._enhancedEcommerceEnabled(!0,"addImpression")){K(function(t){return U("trackEcommerce",t,!0)},"ec:addImpression",{id:t,name:n,category:r,brand:i,variant:c,list:e,position:a,price:o})}})},this._addPromo=function(t,n,e,i){G(function(){H("_addPromo",t,n,e,i)}),z(function(){if(F._enhancedEcommerceEnabled(!0,"addPromo")){K(function(t){return U("trackEcommerce",t,!0)},"ec:addPromo",{id:t,name:n,creative:e,position:i})}})},this._setAction=function(t,n){G(function(){H("_setAction",t,n)}),z(function(){if(F._enhancedEcommerceEnabled(!0,"setAction")){K(function(t){return U("trackEcommerce",t,!0)},"ec:setAction",t,n)}})},this._trackTransaction=function(t,n,e,i,r,c,a,o,s){this._setAction("purchase",B(t,n,e,i,r,c,a,o,s))},this._trackRefund=function(t){this._setAction("refund",B(t))},this._trackCheckOut=function(t,n){this._setAction("checkout",B(null,null,null,null,null,null,null,t,n))},this._trackDetail=function(){this._setAction("detail"),this._pageView()},this._trackCart=function(t,n){-1!==["add","remove"].indexOf(t)&&(this._setAction(t,{list:n}),this._trackEvent("UX","click",t+("add"===t?" to cart":" from cart")))},this._promoClick=function(t){this._setAction("promo_click"),this._trackEvent("Internal Promotions","click",t)},this._productClick=function(t){this._setAction("click",B(null,null,null,null,null,null,t,null,null)),this._trackEvent("UX","click",t)},this._pageView=function(t){z(function(){J(M("send",t),"pageview")})},this._send=function(){var t=Array.prototype.slice.call(arguments);t.unshift("send"),z(function(){J.apply(F,t)})},this._set=function(t,n,e){z(function(){J(M("set",e),t,n)})},this._trackTimings=function(t,e,i,r){z(function(){K(n,"send","timing",t,e,i,r)})},this._trackException=function(t,e){z(function(){K(n,"send","exception",{exDescription:t,exFatal:!!e})})},d||(this._registerScriptTags(),this._registerTrackers()),x&&S.$on(b,function(){(!w&&!T||O.current&&O.current.templateUrl&&!O.current.doNotTrack)&&F._trackPage()}),{log:F.log,offlineQueue:F.offlineQueue,configuration:{accounts:e,universalAnalytics:o,crossDomainLinker:u,crossLinkDomains:i,currency:l,debugMode:f,delayScriptTag:d,disableAnalytics:m,displayFeatures:p,domainName:r,ecommerce:F._ecommerceEnabled(),enhancedEcommerce:F._enhancedEcommerceEnabled(),enhancedLinkAttribution:k,experimentId:c,hybridMobileSupport:E,ignoreFirstPageLoad:_,logAllCalls:y,pageEvent:b,readFromRoute:w,readFromUIRouter:T,removeRegExp:a,testMode:A,traceDebuggingMode:D,trackPrefix:P,trackRoutes:x,trackUrlParams:L},getUrl:R,registerScriptTags:function(){return F._registerScriptTags()},registerTrackers:function(){return F._registerTrackers()},offline:function(t){if(!0===t&&!1===v&&(v=!0),!1===t&&!0===v)for(v=!1;F.offlineQueue.length>0;){var n=F.offlineQueue.shift();n[0].apply(F,n[1])}return v},trackPage:function(t,n,e){F._trackPage.apply(F,arguments)},trackEvent:function(t,n,e,i,r,c){F._trackEvent.apply(F,arguments)},addTrans:function(t,n,e,i,r,c,a,o,s){F._addTrans.apply(F,arguments)},addItem:function(t,n,e,i,r,c){F._addItem.apply(F,arguments)},trackTrans:function(){F._trackTrans.apply(F,arguments)},clearTrans:function(){F._clearTrans.apply(F,arguments)},addProduct:function(t,n,e,i,r,c,a,o,s,u){F._addProduct.apply(F,arguments)},addPromo:function(t,n,e,i){F._addPromo.apply(F,arguments)},addImpression:function(t,n,e,i,r,c,a,o){F._addImpression.apply(F,arguments)},productClick:function(t){F._productClick.apply(F,arguments)},promoClick:function(t){F._promoClick.apply(F,arguments)},trackDetail:function(){F._trackDetail.apply(F,arguments)},trackCart:function(t,n){F._trackCart.apply(F,arguments)},trackCheckout:function(t,n){F._trackCheckOut.apply(F,arguments)},trackTimings:function(t,n,e,i){F._trackTimings.apply(F,arguments)},trackTransaction:function(t,n,e,i,r,c,a,o,s){F._trackTransaction.apply(F,arguments)},trackException:function(t,n){F._trackException.apply(F,arguments)},setAction:function(t,n){F._setAction.apply(F,arguments)},pageView:function(){F._pageView.apply(F,arguments)},send:function(t){F._send.apply(F,arguments)},set:function(t,n,e){F._set.apply(F,arguments)}}}]}).directive("gaTrackEvent",["Analytics","$parse",function(t,n){return{restrict:"A",link:function(e,i,r){var c=n(r.gaTrackEvent);i.bind("click",function(){r.gaTrackEventIf&&!e.$eval(r.gaTrackEventIf)||c.length>1&&t.trackEvent.apply(t,c(e))})}}}]),t.module("angular-google-analytics")});